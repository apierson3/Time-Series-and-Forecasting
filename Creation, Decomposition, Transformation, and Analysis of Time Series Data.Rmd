---
title: "Assignment 1"
author: "Andrew Pierson"
date: "10/28/2018"
output: html_document
---

```{r setup, include=FALSE}
library(knitr)
knitr::opts_chunk$set(echo = TRUE)
```

## Problem 1: Crude Oil Prices

### Read in Libraries and Data

```{r crude oil}
#Check to see where the current working directory is
getwd()
#Set the new working directory to the local csv file
setwd("C:/Users/tableau/Desktop/Assignment1/")
#Read in the csv and define the data frame
crudeoil <- read.csv("crudeoil_w0416.csv")
#Inspect the head of the data frame
head(crudeoil)
#Check the summary statistics of the prices to adjust the plot
summary(crudeoil)
```

### A) Plot Time Series Data

The Crude Oil Prices From 2004 To 2016 time series plot indicates a positive trend overall, however there are sevveral outliers towards the middle of the time period and a sudden decrease in price at the end of 2014. There is a possibility that seasonality might be a contributing factor as well but it is difficult to tell when looking at the entire window. To improve this I shrunk the window to a period that excludes the major outliers. 

```{r Problem 1 Part A}
#Read in the csv and define the data frame
crudeoil <- read.csv("crudeoil_w0416.csv")
#Load in packages and install
library(magrittr)
library(zoo)
library(ggplot2)
#Format the data frame date column
crudeoil$date <- as.Date(crudeoil$date, "%d-%b-%y")
#Check that class of index column is a date
class(date)
#Use ggplot to create a time series plot with title and axis labels 
crudeoil %>%
  ggplot(aes(x = date, y = price, group = 1)) + ggtitle("Crude Oil Prices From 2004 To 2016") + geom_line() + scale_x_date(labels = function(x) format(x, "%d-%b-%y"))
```

### B) Percentage Change Rate of Spot Prices
The percent change of oil prices over time indicate that the two areas that were percieved as outliers are also the time periods that have the greatest variation from normal price fluctuation. This is interesting and I think it would be beneficial to know where this data came from in order to search for clues as to what is causing drasttic percent changes in crude oil prices. Perhaps this could be from a government deal negotiation or war efforts in foreign countries. 

```{r Problem 1 Part B}
#Read in the csv and define the data frame
crudeoil <- read.csv("crudeoil_w0416.csv")
#Create a zoo object using the crude oil price data 
crudeoil = zoo(crudeoil$price, as.Date(as.character(crudeoil$date), format = "%d-%b-%y"))
#Check that class of the crudeoil object is zoo
class(crudeoil)
pricelag = lag(crudeoil, k = -1)
#Inspect the first few data points
head(pricelag)
#Create a manual calculation for the rate of change of price 
PriceDiff = (crudeoil - pricelag)/pricelag
#Use ggplot to create a time series plot with title and axis labels 
PriceDiff %>%
  autoplot.zoo() + ggtitle("Rate of Crude Oil Price Change") + xlab("Date") + ylab("Rate of Price Change") + scale_x_date(labels = function(x) format(x, "%d-%b-%y"))
```

### C) Percentage Change Rate of Spot Prices Histogram
The Rate of Crude Oil Price Change histogram and normal Q-Q plots both indicate a slightly abnormal distribution. The distribution is weighted more negatively with a short decreasing tail on the negative side. Alternatively, the positive side of the distribution has a tail that decreases and then has an upward curve at the end. 

```{r Problem 1 Part C}
#Plot a histogram with a title and axis labels
hist(PriceDiff, xlab = "Rate of Price Change", ylab = "Date", main = "Rate of Crude Oil Price Change Histogram")
```

### C) Percentage Change Rate of Spot Prices Normal Q-Q Plot

```{r Problem 1 Part C 2}
#Plot a Normal Q-Q distribution
qqnorm(PriceDiff, main = "Rate of Crude Oil Price Change Normal Q-Q Plot")
#Fit a baseline to the Normal Q-Q plot
qqline(PriceDiff, col = 2)
```

### D) Log of Crude Oil Spot Prices
The Log Plot of Crude Oil Spot Prices is similar, if not identical, to the Rate of Change time series plot. This is very interesting as the manual function that was created for the rate of change is the same as the difference in log function. This would be an easy way to plot the rate of change without needing to define more variables. 

```{r Problem 1 Part D}
#Read in the csv and define the data frame
crudeoil <- read.csv("crudeoil_w0416.csv")
#Create a zoo object using the crude oil price data 
crudeoil = zoo(crudeoil$price, as.Date(as.character(crudeoil$date), format = "%d-%b-%y"))
#Create a price lag variable
pricelag = lag(crudeoil, k = -1)
#Inspect the first few data points
head(pricelag)
#Calculate the lagging difference of the log of prices 
LogDiff = diff(log(crudeoil))
#Use ggplot to create a time series plot with title and axis labels 
LogDiff %>%
  autoplot.zoo() + ggtitle("Log of Crude Oil Price Change") + xlab("Date") + ylab("Log of Price Change") + scale_x_date(labels = function(x) format(x, "%d-%b-%y"))
```

## Problem 2: Hyndman Chapter 2 Exercise 3

### A) Load Data and Inspect

```{r Problem 2 Part A}
#Read in the data set
retaildata <- readxl::read_excel("C:/Users/tableau/Desktop/Assignment1/retail.xlsx", skip=1)
#Explore the first few rows of data and different columns
head(retaildata)
```

### B) Select Time Series

```{r Problem 2 Part B}
#Define my time series object as myts and specify the value to be explored
myts <- ts(retaildata[,"A3349910A"],
  frequency=12, start=c(1982,4))
```

### C) Explore Plots
  From the autoplot of the time series, it is clear that the value of A3349910A is increasing since the beginning of its time. In addition, this increasing trend appears to fit closely to an exponentially increasing curve rather than a linearly increasing line. Plotting the A3349910A values with respect to their corresponding dates in a year over year seasonal plot reveals increasing seasonality of values. As the year approaches the current date, seasonal effects can be seen because the variation increases. From the Retail Seasonal Plot we can see that values tend to spike every other month in a cyclical nature. 
  From the Retail Seasonal Subseries Plot we see that although there is seasonality. it is very minimal as the mean hardly changes from month to month. The Retail Correlogram resulted in large, positive autocorrelation values. However, the seasonal lags are hardly apparent from the plot which indicates that further testing would be needed to conclusively say that there is seasonality.

```{r Problem 2 Part C Autoplot}
#Autoplot the retail data
myts %>%
  autoplot.zoo()  + ggtitle("Retail Autoplot")
#Load the forecast library
library(forecast)
#Check for seasonality and cyclicality 
ggseasonplot(myts)  + ggtitle("Retail Seasonal Plot")
ggseasonplot(myts, polar = TRUE)  + ggtitle("Retail Seasonal Plot")
#Subseries plot
ggsubseriesplot(myts)  + ggtitle("Retail Seasonal Subseries Plot")
#Lag plot
gglagplot(myts)  + ggtitle("Retail Lag Plot")
#Acf plot
ggAcf(myts)  + ggtitle("Retail Correlogram")
```

## Problem 3: R-bloggers Tutorial

### Exercise 1
Create a variable that is the start date and set it equal to January 23, 2017.

```{r Problem 3 Exercise 1}
#Download and install Lubridate package
#install.packages("lubridate")
library(lubridate)
start_date<- dmy("23012017")
start_date
```

### Exercise 2
Return the current date using the today function. 

```{r Problem 3 Exercise 2}
#Print the current date using the today function
today()
```

### Exercise 3
This package can also return the value of the year of our start date variable.

```{r Problem 3 Exercise 3}
#Extract the year part from the "start_date" variable created on exercise 1
year(start_date)
```

### Exercise 4
This package can also return the value of the month of our start date variable.

```{r Problem 3 Exercise 4}
#Extract the month part from the "start_date" variable created on exercise 1
month(start_date)
```

### Exercise 5
This package can also return the value of the day of our start date variable.

```{r Problem 3 Exercise 5}
#Extract the day part from the "start_date" variable created on exercise 1
day(start_date)
```

### Exercise 6
Start date can be set to February using the numerical representation of the month.

```{r Problem 3 Exercise 6}
#Set the month in variable "start_date" to February
month(start_date) <- 2
#Print the new month of the start_date
month(start_date)
```

### Exercise 7
By adding six days to the start date, the variable has changed month value as well. In this exercise we see that six days later will result in a start date on the first day of March.

```{r Problem 3 Exercise 7}
#Add 6 days to variable "start_date".
start_date + days(6)
```

### Exercise 8
Subtracting three months from the start date moves the value of the year back to November of 2016. 

```{r Problem 3 Exercise 8}
#Substract 3 months from variable "start_date"
start_date - months(3)
```

### Exercise 9
Creating a vector of dates that are concatenated in the order of day, month, year. 

```{r Problem 3 Exercise 9}
#Populate a field called concatenated_dates with a vector of dates
concatenated_dates <- dmy(c("31.12.2015", "01.01.2016",  "15.02.2016"))
concatenated_dates
```

### Exercise 10
Adding one through ten dats to the start date variable successively adds the amount of days and returns them.

```{r Problem 3 Exercise 10}
#Calculate in a short and simple way the addition of 1 thru 10 days to "start_date" variable
start_date + c(1:10) * days(1)
```
